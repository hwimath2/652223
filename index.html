<!-- 1. 시작 화면에 이름 입력란 추가 -->
<div id="startScreen">
  <h2>난이도를 선택하세요</h2>
  <p style="text-align:center">
    <input id="playerName" type="text" placeholder="이름을 입력하세요" />
  </p>
  <p style="text-align:center">
    <button onclick="startGame('최상')">최상 (20초, +20점)</button>
    <button onclick="startGame('상')">상 (30초, +15점)</button>
    <button onclick="startGame('중')">중 (40초, +13점)</button>
    <button onclick="startGame('하')">하 (시간무제한, +10점)</button>
  </p>
</div>

<!-- ... 기존 코드 ... -->

<!-- 2. 게임 종료 화면에 전송하기 버튼과 결과 표시 영역 추가 -->
<div id="gameOverScreen" class="hidden">
  <h2>게임 종료!</h2>
  <p id="finalScore"></p>
  <button onclick="sendGameData()">전송하기</button>
  <button onclick="location.reload()">다시 시작하기</button>
  <pre id="response"></pre>
</div>

<!-- ... 기존 스크립트 내 다른 함수들 ... -->

<script>
  // 기존 gameOver 함수 (게임 종료 시 호출)
  function gameOver(){
    document.getElementById("gameArea").classList.add("hidden");
    document.getElementById("gameOverScreen").classList.remove("hidden");
    document.getElementById("finalScore").textContent=
      "당신의 최종 점수는 " + score + "점 입니다. (총 경과: " + totalTime + "초)";
  }

  // 3. 서버 데이터 전송 함수 (비동기 함수로 수정)
  async function saveData(game, name, score, elapsedTime) {
      const FUNCTION_URL = "https://us-central1-record-f420d.cloudfunctions.net/report";

      const requestData = {
          game,
          name,
          score: parseInt(score, 10),
          elapsedTime: parseInt(elapsedTime, 10)
      };

      try {
          const response = await fetch(FUNCTION_URL, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify(requestData)
          });

          const responseData = await response.json();

          if (response.ok) {
              document.getElementById('response').innerText = 
                  `성공: ${JSON.stringify(responseData, null, 2)}`;
          } else {
              document.getElementById('response').innerText = 
                  `오류: ${JSON.stringify(responseData, null, 2)}`;
          }
      } catch (error) {
          console.error('요청 실패:', error);
          document.getElementById('response').innerText = 
              `네트워크 오류: ${error.message}`;
      }
  }

  // 전송하기 버튼 클릭 시 호출되는 함수
  function sendGameData() {
      const game = document.title; // 게임 제목 (예: "휘매쓰 연산 챌린지!")
      const name = document.getElementById("playerName").value;
      saveData(game, name, score, totalTime);
  }
</script>
